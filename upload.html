<!DOCTYPE html>
<html>
    <head>
        <title>Teilen</title>
        <meta charset="UTF-8"/>
        <script src="scripts/shared.js"></script>
        <link rel="stylesheet" type="text/css" href="styles/shared.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script
              src="https://code.jquery.com/jquery-3.3.1.min.js"
              integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
              crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <style>

input[type='file'] {
    margin-bottom: 1em;
}

label {
    margin: 0;
}

        </style>
    </head>
    <body>

        <div id="title" class="text-center" style="padding:1% 3%;">Upload</div>

        <div id="subtitle" class="text-white bg-primary rounded" style="padding:1% 3%; min-height: 50px;">Mise en ligne d'un fichier</div>

        <div id="form" class="form-group" style="padding:3%; overflow-x: scroll; height:70%;">
            <form>
                <table style="width:100%;">
                    <tr>
                        <td class="align-top"><label for="ressource_path">Fichier&nbsp;</label></td><td><input id="ressource_path" type="file" /></td>
                    </tr>
                    <tr>
                        <td class="align-top"><label for="ressource_name">Nom&nbsp;</label></td><td><input id="ressource_name" class="form-control" type="text" /></td>
                    </tr>
                    <tr>
                        <td class="align-top">Contenu&nbsp;</td>
                        <td>
                            <input type="checkbox" id="cckCours"/><label for="cckCours">&nbsp;Cours / Fiche</label><br/>
                            <input type="checkbox" id="cckExo"/><label for="cckExo">&nbsp;Exercice</label><br/>
                            <input type="checkbox" id="cckAnnal"/><label for="cckAnnal">&nbsp;Annales</label><br/>
                            <input type="checkbox" id="cckCorrig"/><label for="cckCorrig">&nbsp;Corrigés</label>
                        </td>
                    </tr>
                    <tr>
                        <td class="align-top"><label for="description">Description&nbsp;</label></td>
                        <td><textarea id="description" class="form-control" ></textarea></td>
                    </tr>
                    <tr>
                        <td class="align-top"><label for="tags">Tags&nbsp;</label></td>
                        <td><textarea id="tags" class="form-control text-primary font-italic" ></textarea></td>
                    </tr>
                </table>
            </form>
        </div>

        <div id="buttons" class="fixed-bottom">
            <button class="btn btn-primary" style="width:50%; border-color:black;" onclick="window.history.back();">Annuler</button><button class="btn btn-primary" style="width:50%; border-color:black;" onclick="upload();">Valider</button>        
        </div>

        <script type="application/javascript">
            function upload() {
                var params = getUrlParameter("params").replace(/!/g,"&");
                var newp = "&msg=uplded"; if (!params.includes(newp)) params += newp;
                window.location = "nav_subject.html?" + params;
                
                // var url = document.referrer;
                // url += (url.includes("?") ? "&" : "?") + "msg=uplded";
                // window.location = url;
            }
            
            function init() {
                var path = getUrlParameter("path");
                document.getElementById("subtitle").innerHTML += "<br/>dans " + path;
                
                $('#tags').on('change', function() {
                    var tags = $(this).val();
                    var elems = tags.replace(/\s/g, " ").split(" ");
                    var result = elems.map(
                        function(value) {
                            value = value.replace(/#/g, "");
                            if (value.length == 0) return value;
                            return "#" + value;
                        }
                    );
                    $(this).val(result.join(" ").replace(/\ {2,}/g, " "));
                });
            }
            
            if (window.init) ready(init);
        </script>
    </body>
</html>